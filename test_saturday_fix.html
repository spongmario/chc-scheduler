<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Saturday Shift Fix Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .success { color: green; }
        .error { color: red; }
        pre { background: #f5f5f5; padding: 10px; overflow-x: auto; }
        .schedule-display { margin: 10px 0; }
        .location { margin: 10px 0; padding: 10px; border: 1px solid #ddd; }
        .day { margin: 5px 0; padding: 5px; background: #f9f9f9; }
        .saturday { background: #fff3cd; border-left: 4px solid #ffc107; }
    </style>
</head>
<body>
    <h1>Saturday Shift Fix Test</h1>
    
    <div class="test-section">
        <h2>Test Data</h2>
        <p>Testing with providers who want to work Saturdays:</p>
        <pre>
Name,Days per Week,Saturdays per Month,Preferred Weekday Off,Shift Preference,PTO Date,Location
John Smith,4,2,Monday,Friday,open,mid,12/25/2024,01/01/2025,Central
Sarah Johnson,5,1,Monday,Tuesday,mid,open,12/24/2024,Central
Mike Davis,3,3,Wednesday,Thursday,close,mid,open,,Central
Lisa Wilson,4,2,Tuesday,Wednesday,open,close,12/31/2024,Edmonds
Dr. Robert Chen,5,2,Thursday,Friday,mid,open,close,,Edmonds
Dr. Alex Float,4,2,Tuesday,Wednesday,mid,open,close,,Float
Nurse Float Sally,3,2,Saturday,Sunday,close,mid,01/15/2025,Float
        </pre>
    </div>

    <div class="test-section">
        <h2>Expected Behavior</h2>
        <ul>
            <li>Saturday shifts should be filled with providers who want to work Saturdays (2+ saturdays per month)</li>
            <li>Float providers should be available for Saturday shifts if needed</li>
            <li>Saturday shifts should be 'open' and 'close' only (no 'mid' shift)</li>
            <li>Providers who prefer Saturday off should not be assigned Saturday shifts</li>
        </ul>
    </div>

    <div class="test-section">
        <h2>Test Results</h2>
        <p id="test-results">Click "Run Test" to test Saturday shift assignment.</p>
        <button onclick="runSaturdayTest()">Run Test</button>
        <div id="schedule-results"></div>
    </div>

    <script src="script.js"></script>
    <script>
        function runSaturdayTest() {
            const resultsDiv = document.getElementById('test-results');
            const scheduleDiv = document.getElementById('schedule-results');
            resultsDiv.innerHTML = '<p>Testing Saturday shift assignment...</p>';
            scheduleDiv.innerHTML = '';
            
            // Simulate the test data
            const testData = [
                ['Name', 'Days per Week', 'Saturdays per Month', 'Preferred Weekday Off', 'Shift Preference', 'PTO Date', 'Location'],
                ['John Smith', '4', '2', 'Monday,Friday', 'open,mid', '12/25/2024,01/01/2025', 'Central'],
                ['Sarah Johnson', '5', '1', 'Monday,Tuesday', 'mid,open', '12/24/2024', 'Central'],
                ['Mike Davis', '3', '3', 'Wednesday,Thursday', 'close,mid,open', '', 'Central'],
                ['Lisa Wilson', '4', '2', 'Tuesday,Wednesday', 'open,close', '12/31/2024', 'Edmonds'],
                ['Dr. Robert Chen', '5', '2', 'Thursday,Friday', 'mid,open,close', '', 'Edmonds'],
                ['Dr. Alex Float', '4', '2', 'Tuesday,Wednesday', 'mid,open,close', '', 'Float'],
                ['Nurse Float Sally', '3', '2', 'Saturday,Sunday', 'close,mid', '01/15/2025', 'Float']
            ];
            
            try {
                // Test the new scheduling logic
                const scheduler = new CHCScheduler();
                scheduler.parseProviderData(testData);
                
                // Set a test month with Saturdays
                scheduler.selectedMonth = '2024-12';
                
                // Generate schedule
                scheduler.generateSchedule();
                
                let results = '<h3>Schedule Generation Results:</h3>';
                results += '<p class="success">✅ Schedule generated successfully!</p>';
                
                // Check Saturday assignments
                let saturdayCount = 0;
                let saturdayAssignments = [];
                
                for (const location in scheduler.schedule) {
                    for (const day in scheduler.schedule[location]) {
                        const dayData = scheduler.schedule[location][day];
                        const date = new Date(2024, 11, parseInt(day)); // December 2024
                        const dayOfWeek = date.getDay();
                        
                        if (dayOfWeek === 6) { // Saturday
                            saturdayCount++;
                            const hasOpen = dayData.shifts.open.length > 0;
                            const hasClose = dayData.shifts.close.length > 0;
                            const hasMid = dayData.shifts.mid.length > 0;
                            
                            saturdayAssignments.push({
                                day: day,
                                location: location,
                                open: dayData.shifts.open,
                                close: dayData.shifts.close,
                                mid: dayData.shifts.mid,
                                hasOpen,
                                hasClose,
                                hasMid
                            });
                        }
                    }
                }
                
                results += `<p><strong>Saturday Analysis:</strong></p>`;
                results += `<p>Total Saturdays in December 2024: ${saturdayCount}</p>`;
                
                let allSaturdaysFilled = true;
                let saturdayResults = '<h3>Saturday Assignments:</h3>';
                
                saturdayAssignments.forEach(assignment => {
                    const isFilled = assignment.hasOpen && assignment.hasClose && !assignment.hasMid;
                    if (!isFilled) allSaturdaysFilled = false;
                    
                    saturdayResults += `<div class="day saturday">`;
                    saturdayResults += `<strong>Saturday ${assignment.day} (${assignment.location}):</strong> `;
                    if (assignment.hasOpen) saturdayResults += `Open: ${assignment.open.join(', ')} `;
                    if (assignment.hasClose) saturdayResults += `Close: ${assignment.close.join(', ')} `;
                    if (assignment.hasMid) saturdayResults += `Mid: ${assignment.mid.join(', ')} `;
                    if (!isFilled) saturdayResults += ` <span class="error">❌ Not properly filled</span>`;
                    else saturdayResults += ` <span class="success">✅ Properly filled</span>`;
                    saturdayResults += `</div>`;
                });
                
                if (allSaturdaysFilled) {
                    results += '<p class="success">✅ All Saturday shifts are properly filled!</p>';
                } else {
                    results += '<p class="error">❌ Some Saturday shifts are not properly filled!</p>';
                }
                
                resultsDiv.innerHTML = results;
                scheduleDiv.innerHTML = saturdayResults;
                
            } catch (error) {
                resultsDiv.innerHTML = `<p class="error">Error: ${error.message}</p>`;
                console.error('Test error:', error);
            }
        }
    </script>
</body>
</html>
